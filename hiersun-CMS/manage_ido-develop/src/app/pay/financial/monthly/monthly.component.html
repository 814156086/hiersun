<div class="datalist">
  <!-- BEGIN PAGE TITLE -->
  <div class="page-head">
    <div class="page-title">
      <h1>财务月报表
        <!--<small>edi-channel</small>-->
      </h1>
    </div>
  </div>
  <!-- END PAGE TITLE -->
  <div class="row">
    <div class="col-md-12">
      <div class="portlet-body">
        <div class="contenttab">
          <!--月报筛选条件-->
          <div class="choosesx row" style="margin-top: 15px">
            <!--格式一-->
            <div class="form-inline" id="search">
              <div class="form-group col-md-4" style="margin-top:10px;">
                <label class="control-label col-md-4"> 月份：</label>
                <div class="col-md-7">
                    <input style="width: 100%" id="mmonth" type="text" class="form-control brand" placeholder="请输入月份">
                </div>
              </div>
              <div class="form-group col-md-4" style="margin-top:10px;">
                <label class="control-label col-md-4"> 渠道代码：</label>
                <div class="col-md-7">
                    <select style="width: 100%" id="mchannelcode" class="form-control select2me" data-placeholder=" ">
                        <option value="">请选择</option>
                        <option *ngFor="let sourceitem of sourceList;let sourcekey=index;" value="{{sourceitem.channelCode}}">{{sourceitem.channelName}}</option>
                    </select>
                </div>
              </div>
              <div class="form-group col-md-4" style="margin-top:10px;">
                <label class="control-label col-md-4"> 门店号：</label>
                <div class="col-md-7">
                    <select style="width: 100%" id="mstorecode" class="form-control select2me" data-placeholder=" ">
                        <option value="">请选择</option>
                        <option *ngFor="let stoitem of storeList;let stokey=index;" value="{{stoitem.organizationCode}}">{{stoitem.organizationCode}}:{{stoitem.organizationName}}</option>
                    </select>
                </div>
              </div>
              <div class="form-group col-md-4" style="margin-top:10px;">
                <label class="control-label col-md-4"> 品牌编码：</label>
                <div class="col-md-7">
                    <select style="width: 100%" id="mbrandno" class="form-control select2me" data-placeholder=" ">
                        <option value="">请选择</option>
                        <option *ngFor='let brandlist of brandlist' value="{{brandlist.brandSid}}">{{brandlist.brandName}}</option>
                    </select>
                </div>
              </div>
              <div class="form-group col-md-4 text-center" style="margin-top:10px;">
                <button style="margin: 0 10px" (click)='monthstatement()' class="btn green btn-default">查询</button>&nbsp;&nbsp;&nbsp;&nbsp;
                <button style="margin: 0 10px" class="btn green btn-default" (click)='loadAgain()'>重置</button>
              </div>
            </div>
          </div>
          <!--月报-->
          <div class="portlet box blue-hoki" style="margin-top:10px;">
            <!--列表头-->
            <div class="portlet-title">
              <div class="caption">
                <i class="fa fa-globe"></i>财务月报表列
              </div>
              <div class="tools">
                <a href="javascript:;" class="collapse" data-original-title="" title=""></a>
              </div>
            </div>
            <!--列表end-->
            <!--body-->
            <div class="portlet-body">
              <div class="table-scrollable">
                <table class="table table-striped table-bordered table-hover dataTable no-footer" id="sample_1" role="grid" aria-describedby="sample_1_info">
                  <thead>
                  <tr>
                    <th>操作</th>
                    <th style="min-width: 35px">月份</th>
                    <th>渠道代码</th>
                    <th>上月收款未入账</th>
                    <th>上月入账未收款</th>
                    <th>本月POS数</th>
                    <th>本月预收款</th>
                    <th>本月刷单费</th>
                    <th>本月维修费</th>
                    <th>本月测试费</th>
                    <th>本月应回款</th>
                    <th>本月已回款</th>
                    <th>差异金额</th>
                    <th>已收款未入账</th>
                    <th>已入账未收款</th>
                    <th>差异后金额</th>
                    <th>品牌编码</th>
                    <th>门店号</th>
                    <th>已入账已结算</th>
                    <th>订单数量</th>
                    <th style="min-width:300px;">备注</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr role="row" class="odd" *ngFor = 'let item of monthList'>
                    <td>
                      <a class="btn btn-xs btn-info" (click)='detail(item.month)'>
                        <i class="fa fa-edit"></i> 明细 </a>
                      <a class="btn btn-xs btn-info" (click)='updateMonthShow(item)'>
                        <i class="fa fa-edit"></i> 重算 </a>
                      <a class="btn btn-xs btn-info" (click)='commShow(item)'>
                        <i class="fa fa-edit"></i> 备注 </a>
                    </td>
                    <td *ngIf='item.totalDiffAmount==0 || item.comm'>{{item.month}}</td>
                    <td style="color: #f00;" title="您的差异金额不为0,请填写备注!" *ngIf='item.totalDiffAmount!=0 && !item.comm'>{{item.month}}</td>
                    <td *ngIf='item.channelName'>{{item.channelName}}</td>
                    <td *ngIf='!item.channelName'>-</td>
                    <td *ngIf='item.preUncomeAmount'>{{item.preUncomeAmount |  number:'.2-2'}}</td>
                    <td *ngIf='!item.preUncomeAmount'>-</td>
                    <td *ngIf='item.preNrcyAmount'>{{item.preNrcyAmount |  number:'.2-2'}}</td>
                    <td *ngIf='!item.preNrcyAmount'>-</td>
                    <td *ngIf='item.posAmount'>{{item.posAmount}}</td>
                    <td *ngIf='!item.posAmount'>-</td>
                    <td *ngIf='item.depositReceivedAmount'>{{item.depositReceivedAmount |  number:'.2-2'}}</td>
                    <td *ngIf='!item.depositReceivedAmount'>-</td>
                    <td *ngIf='item.scalpingBillAmount'>{{item.scalpingBillAmount |  number:'.2-2'}}</td>
                    <td *ngIf='!item.scalpingBillAmount'>-</td>
                    <td *ngIf='item.repaireAmount'>{{item.repaireAmount |  number:'.2-2'}}</td>
                    <td *ngIf='!item.repaireAmount'>-</td>
                    <td *ngIf='item.testAmount'>{{item.testAmount |  number:'.2-2'}}</td>
                    <td *ngIf='!item.testAmount'>-</td>
                    <td *ngIf='item.expectAmount'>{{item.expectAmount |  number:'.2-2'}}</td>
                    <td *ngIf='!item.expectAmount'>-</td>
                    <td *ngIf='item.returnedAmount'>{{item.returnedAmount |  number:'.2-2'}}</td>
                    <td *ngIf='!item.returnedAmount'>-</td>
                    <td *ngIf='item.diffAmount'>{{item.diffAmount |  number:'.2-2'}}</td>
                    <td *ngIf='!item.diffAmount'>-</td>
                    <td *ngIf='item.uncomeAmount'>{{item.uncomeAmount |  number:'.2-2'}}</td>
                    <td *ngIf='!item.uncomeAmount'>-</td>
                    <td *ngIf='item.nrcyAmount'>{{item.nrcyAmount |  number:'.2-2'}}</td>
                    <td *ngIf='!item.nrcyAmount'>-</td>
                    <td *ngIf='item.totalDiffAmount'>{{item.totalDiffAmount |  number:'.2-2'}}</td>
                    <td *ngIf='!item.totalDiffAmount'>-</td>
                    <td *ngIf='item.brandName'>{{item.brandName}}</td>
                    <td *ngIf='!item.brandName'>-</td>
                    <td *ngIf='item.storeCode'>{{item.storeCode}}</td>
                    <td *ngIf='!item.storeCode'>-</td>
                    <td *ngIf='item.incomeAmount'>{{item.incomeAmount |  number:'.2-2'}}</td>
                    <td *ngIf='!item.incomeAmount'>-</td>
                    <td *ngIf='item.orderCount'>{{item.orderCount}}</td>
                    <td *ngIf='!item.orderCount'>-</td>
                    <td *ngIf='item.comm'>{{item.comm}}</td>
                    <td *ngIf='!item.comm'>-</td>
                  </tr>
                  </tbody>
                </table>
              </div>
              <div class="clearfix">
                  <div id="pagination2" class="page"></div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>

<!--默认加载图标-->
<!--<div class="spinner" *ngIf="isload">
  <div class="bounce1"></div>
  <div class="bounce2"></div>
  <div class="bounce3"></div>
</div>-->
<!--默认加载图标end-->
<div id="hint" *ngIf="isHint">
  <div class="hintMsg">
    <i *ngIf="warning" class="warningMsg"></i>
    <i *ngIf="!warning" class="ok"></i>
    <span>{{hintMsg}}</span>
  </div>
</div>

<!--明细-->
<div id="detail" class="modal fade" role="dialog" aria-hidden="true">
  <div class="modal-dialog" style="width: 1100px">
    <div class="modal-content" style="max-height: 650px;overflow: auto!important">
      <div class="modal-header">
        <button type="button" class="bootbox-close-button close" data-dismiss="modal" aria-hidden="true">
          <span style="vertical-align: inherit;">
            <span style="vertical-align: inherit;">×</span>
          </span>
        </button>
        <h4 class="modal-title">
          <span style="vertical-align: inherit;">
            <span style="vertical-align: inherit;">财务日明细</span>
          </span>
        </h4>
      </div>
      <div class="modal-body">
        <div class="choosesx row" style="margin-top: 15px">
                <div class="form-inline" id="search">
                    <div class="form-group col-md-4 col-sm-6 col-xs-12" style="margin-top:10px;">
                        <label class="control-label col-md-4"> 订单类别 ：</label>
                        <div class="col-md-7">
                        <select style='width: 100%!important'  id="otype" class="form-control input-large input-inline platform">
                            <option value="">请选择</option>
                            <option  *ngFor="let item of typeList" value="{{item.value}}">{{item.text}}</option>
                        </select>
                        </div>
                    </div>
                    <div class="form-group col-md-4 col-sm-6 col-xs-12" style="margin-top:10px;">
                        <label class="control-label col-md-4"> 渠道代码：</label>
                        <div class="col-md-7">
                            <select style="width: 100%" id="channelcode" class="form-control select2me" data-placeholder=" ">
                                <option value="">请选择</option>
                                <option *ngFor="let sourceitem of sourceList;let sourcekey=index;" value="{{sourceitem.channelCode}}">{{sourceitem.channelName}}</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group col-md-4 col-sm-6 col-xs-12" style="margin-top:10px;">
                        <label class="control-label col-md-4">门店号：</label>
                        <div class="col-md-7">
                            <select style="width: 100%" id="storecode" class="form-control select2me" data-placeholder=" ">
                                <option value="">请选择</option>
                                <option *ngFor="let stoitem of storeList;let stokey=index;" value="{{stoitem.organizationCode}}">{{stoitem.organizationCode}}:{{stoitem.organizationName}}</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group col-md-4 col-sm-6 col-xs-12" style="margin-top:10px;">
                        <label class="control-label col-md-4"> 平台单号：</label>
                        <div class="col-md-7">
                            <input style="width: 100%" id="outtradeno" type="text" class="col-md-7 form-control brand" placeholder="请输入平台单据号">
                        </div>
                    </div>
                    <div class="form-group col-md-4" style="margin-top:10px;">
                      <label class="control-label col-md-4"> 交易时间 ：</label>
                      <div class="col-md-7">
                        <!--<input style="width: 100%"  id="month-successtime" type="text" class="col-md-7 form-control" placeholder="请输入交易时间 ">-->
                        <input style="width: 100%"  id="month-successtime" type="text" class="col-md-7 form-control" placeholder="请输入交易时间 " readonly>
                      </div>
                    </div> 
                    <div class="form-group col-md-4 col-sm-6 col-xs-12" style="margin-top:10px;">
                        <label class="control-label col-md-4"> 品牌编码：</label>
                        <div class="col-md-7">
                            <select style="width: 100%" id="brandno" class="form-control select2me" data-placeholder=" ">
                                <option value="">请选择</option>
                                <option *ngFor='let brandlist of brandlist' value="{{brandlist.brandSid}}">{{brandlist.brandName}}</option>
                            </select>
                        </div>
                    </div>     
                    <!--<div class="form-group col-md-4 col-sm-6 col-xs-12" style="margin-top:10px;">
                        <label class="control-label col-md-4"> 交易成功结束时间：</label>
                        <div class="col-md-7">
                            <input style="width: 100%" id="endSuccessTime" type="text" class="col-md-7 form-control endDate brand" placeholder="请输入交易成功结束时间">
                        </div>
                    </div>-->
                    <div id="isSettlementbox" class="form-group col-md-4 col-sm-6 col-xs-12" style="margin-top:10px;">
                        <label class="control-label col-md-4"> 是否结算：</label>
                        <div class="col-md-7">
                            <select style="width: 100%" class="issettlement form-control" id="issettlement">
                                <option value="">请选择</option>
                                <option value="0">未结算 </option>
                                <option value="1">已结算 </option>
                            </select>
                        </div>
                        
                    </div>
                    <div id="isVerifybox" class="form-group col-md-4 col-sm-6 col-xs-12" style="margin-top:10px;">
                        <label class="control-label col-md-4"> 是否核销：</label>
                        <div class="col-md-7">
                            <select style="width: 100%" class="form-control isverify" id="isverify">
                                <option value="">请选择</option>
                                <option value="0">未核销 </option>
                                <option value="1">已核销 </option>
                            </select>
                        </div>
                        
                    </div>
                    <div class="col-md-12 text-center">
                        <button style="margin: 10px" (click)='detailLoad()' class="btn green btn-default">查询</button>&nbsp;&nbsp;&nbsp;&nbsp;
                        <button style="margin: 10px" class="btn green btn-default" (click)='detailLoadAgain()' >重置</button>
                    </div>
                </div>
            </div>
            <div class="portlet box blue-hoki">
                <div class="portlet-title">
                    <div class="caption">
                    <i class="fa fa-globe"></i>财务日明细列表
                    </div>
                    <div class="tools">
                    <a href="javascript:;" class="collapse" data-original-title="" title=""></a>
                    </div>
                </div>
                <div class="portlet-body">
                    <div id="btnbox"></div>
                    <div *ngIf='noCheck' style="width: 100%;color: #f00;text-align: center;margin-top: 10px;">*请选择至少一项</div>
                    <div class="table-scrollable">
                    <!--<div class="table-scrollable" style="max-height: 220px;overflow: auto!important">-->
                    <table class="table table-striped table-bordered table-hover dataTable no-footer" id="sample_1" role="grid" aria-describedby="sample_1_info">
                        <thead>
                        <tr>
                            <th> </th>
                            <th>订单类别</th>
                            <th>销售单明细号</th>
                            <th>品牌编码</th>
                            <th>渠道代码</th>
                            <th>门店号</th>
                            <th>平台单据号</th>
                            <th>定制单号</th>
                            <th>销售单号</th>
                            <th>品类</th>
                            <th>版库编号</th>
                            <th>条码</th>
                            <th>产品名称</th>
                            <th>数量</th>
                            <th>支付金额</th>
                            <th>回款金额</th>
                            <th>业务类型</th>
                            <th>支付类型</th>
                            <th>付款时间</th>
                            <th>销账时间</th>
                            <th>交易创建时间</th>
                            <th>交易成功时间</th>
                            <th>订单状态</th>
                            <th>尾款单号</th>
                            <th>是否已结算</th>
                            <th>是否核销</th>
                            <th>退款单号</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr role="row" class="odd" *ngFor = 'let item of detailList'>
                          <td *ngIf='item.isVerify == 0'>
                            <input type="checkbox" value='{{item.primarySaleItemNo}}'>
                          </td>
                          <td *ngIf='item.isVerify == 1'>
                            <input type="checkbox" value='{{item.primarySaleItemNo}}' disabled='true'>
                          </td>                            
                          <td *ngIf='item.oType==1'>预收款</td>
                          <td *ngIf='item.oType==2'>刷单费</td>
                          <td *ngIf='item.oType==3'>维修费</td>
                          <td *ngIf='item.oType==4'>测试费</td>
                          <td *ngIf='item.oType==5'>平台订单</td>
                          <td *ngIf='item.oType==6'>核销pos</td>
                          <td *ngIf='!item.oType'>-</td>
                          <td *ngIf='item.saleItemNo'>{{item.saleItemNo}}</td>
                          <td *ngIf='!item.saleItemNo'>-</td>
                          <td *ngIf='item.brandName'>{{item.brandName}}</td>
                          <td *ngIf='!item.brandName'>-</td>
                          <td *ngIf='item.channelName'>{{item.channelName}}</td>
                          <td *ngIf='!item.channelName'>-</td>
                          <td *ngIf='item.storeCode'>{{item.storeCode}}</td>
                          <td *ngIf='!item.storeCode'>-</td>
                          <td *ngIf='item.outTradeNo'>{{item.outTradeNo}}</td>
                          <td *ngIf='!item.outTradeNo'>-</td>
                          <td *ngIf='item.customNo'>{{item.customNo}}</td>
                          <td *ngIf='!item.customNo'>-</td>
                          <td *ngIf='item.saleNo'>{{item.saleNo}}</td>
                          <td *ngIf='!item.saleNo'>-</td>
                          <td *ngIf='item.category'>{{item.category}}</td>
                          <td *ngIf='!item.category'>-</td>
                          <td *ngIf='item.spuNo'>{{item.spuNo}}</td>
                          <td *ngIf='!item.spuNo'>-</td>
                          <td *ngIf='item.barcode'>{{item.barcode}}</td>
                          <td *ngIf='!item.barcode'>-</td>
                          <td *ngIf='item.goodsName'>{{item.goodsName}}</td>
                          <td *ngIf='!item.goodsName'>-</td>
                          <td *ngIf='item.goodsNum'>{{item.goodsNum}}</td>
                          <td *ngIf='!item.goodsNum'>-</td>
                          <td *ngIf='item.payAmount'>{{item.payAmount |  number:'.2-2'}}</td>
                          <td *ngIf='!item.payAmount'>-</td>
                          <td *ngIf='item.receivedAmount'>{{item.receivedAmount |  number:'.2-2'}}</td>
                          <td *ngIf='!item.receivedAmount'>-</td>
                          <td *ngIf='item.type=="S"'>交易</td>
                          <td *ngIf='item.type=="R"'>退款</td>
                          <td *ngIf='!item.type'>-</td>
                          <td *ngIf='item.payType==13103'>支付宝</td>
                          <td *ngIf='item.payType==13101'>微信</td>
                          <td *ngIf='item.payType==14112'>微信</td><!-- !!!!!!!!!未确定 -->
                          <td *ngIf='!item.payType'>-</td>
                          <td *ngIf='item.payTime' style='min-width:130px'>{{item.payTime | date:'yyyy-MM-dd HH:mm:ss'}}</td>
                          <td *ngIf='!item.payTime' style='min-width:130px'>-</td>
                          <td *ngIf='item.crossTime' style='min-width:130px'>{{item.crossTime | date:'yyyy-MM-dd HH:mm:ss'}}</td>
                          <td *ngIf='!item.crossTime' style='min-width:130px'>-</td>
                          <td *ngIf='item.tradeTime' style='min-width:130px'>{{item.tradeTime | date:'yyyy-MM-dd HH:mm:ss'}}</td>
                          <td *ngIf='!item.tradeTime' style='min-width:130px'>-</td>
                          <td *ngIf='item.successTime' style='min-width:130px'>{{item.successTime | date:'yyyy-MM-dd HH:mm:ss'}}</td>
                          <td *ngIf='!item.successTime' style='min-width:130px'>-</td>
                          <td *ngIf='item.orderState'>{{item.orderState}}</td>
                          <td *ngIf='!item.orderState'>-</td>
                          <td *ngIf='item.tailNo'>{{item.tailNo}}</td>
                          <td *ngIf='!item.tailNo'>-</td>
                          <td *ngIf='item.isSettlement == 0'>未结算</td>
                          <td *ngIf='item.isSettlement == 1'>已结算</td>
                          <td *ngIf='item.isVerify == 0'>未核销</td>
                          <td *ngIf='item.isVerify == 1'>已核销</td>
                          <td *ngIf='item.refundId'>{{item.refundId}}</td>
                          <td *ngIf='!item.refundId'>-</td>
                        </tr>
                        <tr *ngIf='noData'>
                          <td colspan="13" style="text-align:center;padding:10px;">暂时还没有数据</td>
                        </tr>
                        </tbody>
                    </table>
                    </div>
                    <div class="clearfix">
                        <div id="pagination1" class="page"></div>
                    </div>
                </div>
            </div>
      </div>
      <div class="modal-footer">
        <a class="desc"></a>
        <!--<button class="btn blue delsure" (click)="makesure()">确认</button>-->
        <button class="btn default" data-dismiss="modal" aria-hidden="true">取消</button>
      </div>
    </div>
  </div>
</div>

<!--是否修改订单类别-->
<div id="update-oeder-type">
    <div class="zz">
        <div class="update_content">
            <div class="update_header">
                <span (click)='updateTypeClose()'> <a style="color: #000;">×</a> </span>
            </div>
            <div class="update_info">
                <p>是否确认修改订单类别</p>
            </div>
            <div class="bottom">
                <div>
                    <button (click)='updateOrder()'>确定</button>
                    <button (click)='updateTypeClose()'>关闭</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!--是否确认重算-->
<div id="month-update">
    <div class="zz">
        <div class="update_content">
            <div class="update_header">
                <span (click)='updateMonthClose()'> <a style="color: #000;">×</a> </span>
            </div>
            <div class="update_info">
                <p>是否确认重新计算月报</p>
            </div>
            <div class="bottom">
              <div *ngIf='updateErr' style="margin-bottom: 10px;">
                <div style="display: block;height: 16px;line-height: 16px;font-size: 14px;color: #f00;text-align: left" id="err_hint">系统操作失败,请重新再试</div>
              </div>
              <div>
                <button (click)='updateMonth()'>确定</button>
                <button (click)='updateMonthClose()'>关闭</button>
              </div>
            </div>
        </div>
    </div>
</div>

<!--添加备注-->
<div id="addcomm" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="bootbox-close-button close" data-dismiss="modal" aria-hidden="true">
          <span style="vertical-align: inherit;">
            <span style="vertical-align: inherit;">×</span>
          </span>
        </button>
        <h4 class="modal-title">
          <span style="vertical-align: inherit;">
            <span style="vertical-align: inherit;">添加备注</span>
          </span>
        </h4>
      </div>
      <div class="modal-body">
        <form class="form-horizontal" id="ffSearch">
          <div class="row height-30">
            <div class="col-md-12">
              <div class="form-group">
                <label class="control-label col-md-3" style="text-align: center!important">月份：</label>
                <div class="col-md-8">
                  <input class='form-control' style="border: none!important" disabled='disabled' id="add-month" style='width: 100%' type="text">
                </div>
              </div>
            </div>
            <div class="col-md-12">
              <div class="form-group">
                <label class="control-label col-md-3" style="text-align: center!important">备注：</label>
                <div class="col-md-8">
                  <!--<input class='form-control' disabled='disabled' id="item-update-order-oid" style='width: 100%' type="text" placeholder="请输入子订单编号">-->
                  <textarea class='form-control' placeholder="请输入备注" style='width: 100%' id="commcontent" cols="30" rows="10"></textarea>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <a class="desc"></a>
        <button class="btn blue delsure" (click)="addComm()">确认</button>
        <button class="btn default" data-dismiss="modal" aria-hidden="true">取消</button>
      </div>
    </div>
  </div>
</div>