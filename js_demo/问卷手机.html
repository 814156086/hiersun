<!DOCTYPE html>
<html lang="en">
<head>
    <title>ooh Dear 亲子礼品珠宝</title>
    <meta charset="utf-8">
    <meta content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width" name="viewport">
    <link rel="stylesheet" href="./reset.css">
    <style>
        .box1{
            width: 100px;
            height: 100px;
            background-color: skyblue;
            color: black;
        }
        #referralsText{
            border: 1px solid red;
            width: 200px;
            height: 150px;
            color: black;
        }

        .changeMobile{
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            width: 100%;
            background-color: rgba(0,0,0,.4);
            transition: all .5s;
            display: none;
            opacity: 1;
        }
        .changeMobile_user{
            position: absolute;
            top: 40%;
            left: 50%;
            margin-left: -220px;
            margin-top: -236px;
            height:623px;
            width:440px;
            background:#fafafa;
            border-radius: 5px;
        }
        .changeMobile_user h3 em{
            float:left;
            font-size:18px;
            color:#CB68A4;
            margin-left:18px;
            padding-left:4px;
            margin-bottom:36px;
            padding-top:28px;
        }
        .changeMobile_user h3 span{
            height:28px;
            width:30px;
            display: inline-block;
            background:url(../imgs/cancel.png) no-repeat;
            background-size: contain;
            float:right;
            margin-top:20px;
            margin-right:16px;
        }
        .changeMobile_login{
            margin-left: 18px;
        }
        .changeMobile_login li{
            width:400px;
            height: 56px;
            line-height: 56px;
            border: 1px solid #ddd;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom:12px;
        }
        .changeMobile_login>li>*{
            float: left;
        }
        .changeMobile_login>li>i{
            margin-top: 12px;
            margin-left:14px;
            width: 28px;
            height: 28px;
        }
        .changeMobile_login>li:first-of-type>i{
            background: url(../imgs/pen.png) no-repeat;
            background-size: contain;
        }
        .changeMobile_login>li:nth-of-type(2)>i{
            background: url(../imgs/people.png) no-repeat;
            background-size: contain;
        }
        .changeMobile_login>li:nth-of-type(3)>i{
            background: url(../imgs/lock.png) no-repeat;
            background-size: contain;
            border-bottom: none;
        }
        .changeMobile_login>li>input{
            width: 180px;
            height: 56px;
            line-height: 56px;
            font-size: 15px;
            color: #999;
            text-indent: 14px;
        }
        .changeMobile_login>li>input::placeholder{
            color:#999;
        }
        .changeMobile_login>li>button{
            float: right;
            margin-top: 15px;
            padding: 0 5px;
            height: 26px;
            line-height: 26px;
            font-size: 12px;
            color: #666;
            border-left: 1px solid #F0F0F0;
        }
        .changeMobile_login>li>img{
            float: right;
            width: 120px;
            height: 100%;
            border:1px solid #ddd;
        }
        .changeMobile_btn{
            margin-top: 60px;
            margin-left:28px;
            width: 380px;
            height: 50px;
            line-height: 50px;
            text-align: center;
            font-size: 20px;
            background: #CB68A4;
            border-radius: 25px;
            color:#fff;
        }

    </style>
</head>
<body>
<div class="box1">
    点我点我
</div>
<input id="referralsText" type="text">
<div class="changeMobile" style="display: block;">
    <div class="changeMobile_user">
        <h3><em>请输入原手机号：</em> <span id="changeMobile_close" style="color: black;font-size: 18px">X</span></h3>
        <ul class="changeMobile_login">
            <li>
                <i></i>
                <input class="changeMobile_tel" type="changeMobile_tel" name="" value="" placeholder="请填写手机号" maxlength="11">
                <button type="button">获取验证码</button>
            </li>
            <li>
                <i></i>
                <input class="changeMobile_code" type="text" value="" name="" placeholder="请填输入验证码">
            </li>
        </ul>


        <h3><em>请输入新手机号：</em> <span></span></h3>
        <ul class="changeMobile_login1">
            <li>
                <i></i>
                <input class="changeMobile_tel1" type="changeMobile_tel1" name="" value="" placeholder="请填写手机号" maxlength="11">
                <button type="button">获取验证码</button>
            </li>
            <li>
                <i></i>
                <input class="changeMobile_code1" type="text" value="" name="" placeholder="请填输入验证码">
            </li>
        </ul>
        <button class="changeMobile_btn" type="button">提交</button>
    </div>


</div>
</body>
<script src="jquery-1.7.1.min.js"></script>
<script>
    $('.box1').on('click',function () {
        var referralsText = $('#referralsText').val()
        var reg = /^((1[0-9]{1})+\d{9})$/;
        if(referralsText == ''){

        }else {
            if(!reg.test(referralsText)){
                alert('请填写正确的手机号');
                return false
            }
        }
    })
$('#changeMobile_close').on('click',function () {
    $('.changeMobile').css('opacity',0)
})



////////////////////////////////////////////////////////////
    var reg = /^((1[0-9]{1})+\d{9})$/;
    //验证手机号获取验证码
    (function () {
        var changeMobile_oBtn = $('.changeMobile_login>li>button');
        var num = 60;
        var num1 = 60;
        var timer = null;
        var timer1 = null;
        var iBtn = true;
        var iBtn1 = true;
        var reg = /^((1[0-9]{1})+\d{9})$/;

        changeMobile_oBtn.on('click', function () {
            if (!iBtn) {
                return
            }

            var val = $('.changeMobile_login>li>input.changeMobile_tel').val();

            if (!reg.test(val)) {
                alert('请输入有效的手机号码');
                return;
            }
            iBtn = false;
            timer = setInterval(function () {
                num--;
                changeMobile_oBtn.html(num + 's');
                changeMobile_oBtn.css({
                    'color': '#999',
                    'border': '1px solid #999'
                });
                if (num < 0) {
                    clearInterval(timer);
                    changeMobile_oBtn.html('重新获取');
                    iBtn = true;
                    num = 60;
                    changeMobile_oBtn.css({
                        'color': '#666',
                        'border': '1px solid #666'
                    });
                }
            }, 1000);


            $.ajax({
                type: 'post',
                url: apiUrl + '/user/captcha',
                data: {
                    mobile: val
                },
                success: function (data) {

                    if (data.head.code) {
                        alert(data.head.message);
                    }
                },
                error: function (err) {
                    console.log(err);
                }
            });
        });




        changeMobile_oBtn.on('click', function () {
            if (!iBtn1) {
                return
            }

            var val1 = $('.changeMobile_login1>li>input.changeMobile_tel1').val();

            if (!reg.test(val1)) {
                alert('请输入有效的手机号码');
                return;
            }
            iBtn1 = false;
            timer1 = setInterval(function () {
                num--;
                changeMobile_oBtn1.html(num + 's');
                changeMobile_oBtn1.css({
                    'color': '#999',
                    'border': '1px solid #999'
                });
                if (num < 0) {
                    clearInterval(timer);
                    changeMobile_oBtn1.html('重新获取');
                    iBtn1 = true;
                    num = 60;
                    changeMobile_oBtn1.css({
                        'color': '#666',
                        'border': '1px solid #666'
                    });
                }
            }, 1000);


            $.ajax({
                type: 'post',
                url: apiUrl + '/user/captcha',
                data: {
                    mobile: val1
                },
                success: function (data) {

                    if (data.head.code) {
                        alert(data.head.message);
                    }
                },
                error: function (err) {
                    console.log(err);
                }
            });
        });
    })();


    //登录
    (function () {
        var changeMobile_oLogin = $('.changeMobile_login-btn');//
        var changeMobile_oImg = $('.changeMobile_login>li>img');//
        var changeMobile_oBtn = $('.changeMobile_logout');//
        var changeMobile_oCancel = ('.changeMobile_user h3 span');//
        $(changeMobile_oCancel).on('click', function () {
            location.href = prevUrl();
            $('.changeMobile').css('opacity', 0);
            setTimeout(function () {
                $('.changeMobile').css('display', 'none');
            }, 50);
        })

        changeMobile_oLogin.on('click', function () {

            var changeMobile_iTel = $('.changeMobile_tel').val();//
            var changeMobile_iTel1 = $('.changeMobile_tel1').val();//
            var changeMobile_iCode = $('.changeMobile_code').val();//
            var changeMobile_iCode1 = $('.changeMobile_code1').val();//
            var changeMobile_oP = $('.changeMobile');//
            //var iBtn=false;//控制刚登录时头像显示开关
            if (changeMobile_iTel == '' || changeMobile_iCode == '' || changeMobile_iTel1 == '' || changeMobile_iCode1 == '') {
                alert('手机号或验证码不能为空！');
            } else {
                $.ajax({
                    type: 'post',
                    url: apiUrl + '/user/captchatwo',
                    data: {
                        mobile: changeMobile_iTel,
                        captcha: changeMobile_iCode,
                        newMobile:changeMobile_iTel1,
                        captchatwo:changeMobile_iCode1,
                        memberNo:vipNo
                    },
                    success: function (data) {

                        if (data.head.code) {
                            alert(data.head.message);
                            // return;
                        } else {

                        }
                        location.href = 'index.html?userStatus=' + data.body.userStatus;
                    },
                    error: function (err) {
                        console.log(err);
                    }
                });
            }
        });
    })();
</script>
</html>